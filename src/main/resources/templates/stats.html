<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/layout :: head('学習統計')}"></head>

<body th:replace="~{fragments/layout :: layout(~{::mainContent})}">
    <div th:fragment="mainContent"
        class="relative flex h-full min-h-screen w-full max-w-md flex-col overflow-hidden bg-bg-base mx-auto shadow-2xl">
        <!-- Header -->
        <header
            class="sticky top-0 z-20 flex items-center justify-between px-6 py-6 pt-14 bg-bg-base/90 backdrop-blur-sm">
            <h1 class="text-xl font-bold tracking-tight text-text-main font-japanese">学習統計</h1>
            <div class="flex items-center gap-3">
                <button class="neu-icon-btn h-10 w-10 text-text-sub">
                    <span class="material-symbols-outlined text-[20px]">calendar_today</span>
                </button>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto px-6 pb-32 hide-scrollbar">
            <!-- Overall Summary Card -->
            <section class="mb-10">
                <div class="neu-raised rounded-[2.5rem] p-8 flex flex-col items-center">
                    <div class="relative w-40 h-40 rounded-full neu-pressed flex items-center justify-center mb-6">
                        <div class="flex flex-col items-center">
                            <span class="text-4xl font-black text-primary font-display"
                                th:text="${#numbers.formatDecimal(totalStats.correctRate, 1, 0)} + '%'">0%</span>
                            <span class="text-[9px] font-bold text-text-sub uppercase tracking-[0.2em] mt-1">正答率</span>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 w-full">
                        <div class="neu-raised rounded-2xl p-4 flex flex-col items-center">
                            <span class="text-xs font-bold text-text-sub mb-1 font-japanese">学習単語数</span>
                            <span class="text-xl font-bold text-text-main font-display"
                                th:text="${totalStats.totalAnswered}">0</span>
                        </div>
                        <div class="neu-raised rounded-2xl p-4 flex flex-col items-center">
                            <span class="text-xs font-bold text-text-sub mb-1 font-japanese">苦手単語数</span>
                            <span class="text-xl font-bold text-red-400 font-display"
                                th:text="${totalStats.weakWordCount}">0</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Category-wise Stats -->
            <section class="mb-10">
                <div class="flex items-center justify-between mb-6 px-1">
                    <h2 class="text-base font-bold text-text-main font-japanese">カテゴリー別進捗</h2>
                    <span class="text-[10px] font-bold text-text-sub uppercase tracking-widest">Last 14 Days</span>
                </div>

                <div class="space-y-6">
                    <div th:each="cat : ${categoryDetailStats}"
                        class="neu-raised rounded-3xl p-6 flex flex-col gap-4 group">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div
                                    class="w-10 h-10 rounded-full neu-pressed flex items-center justify-center text-primary">
                                    <span class="material-symbols-outlined text-[20px]">folder</span>
                                </div>
                                <div>
                                    <h3 class="font-bold text-text-main text-sm font-japanese"
                                        th:text="${cat.categoryName}">Category Name</h3>
                                    <p class="text-[10px] text-text-sub font-medium"
                                        th:text="${cat.wordCount} + ' 単語登録済み'">0 words</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="text-lg font-bold text-primary font-display"
                                    th:text="${#numbers.formatDecimal(cat.correctRate, 1, 0)} + '%'">0%</span>
                            </div>
                        </div>

                        <!-- Mini Progress Bar -->
                        <div class="space-y-2">
                            <div class="flex justify-between text-[10px] font-bold text-text-sub px-1">
                                <span class="font-japanese">カテゴリー内正答率</span>
                                <span th:text="${cat.totalCorrect} + ' / ' + ${cat.totalAnswered}">0 / 0</span>
                            </div>
                            <div class="h-3 w-full rounded-full neu-pressed p-[2px] overflow-hidden">
                                <div class="h-full rounded-full transition-all duration-1000 shadow-sm"
                                    th:classappend="${cat.correctRate >= 80 ? 'bg-green-400' : (cat.correctRate >= 50 ? 'bg-primary' : 'bg-red-300')}"
                                    th:style="'width: ' + ${cat.correctRate} + '%'"></div>
                            </div>
                        </div>

                        <div class="flex gap-4 mt-1 border-t border-text-sub/5 pt-4">
                            <div class="flex-1 text-center">
                                <p class="text-[9px] font-bold text-text-sub uppercase mb-1">苦手な単語</p>
                                <p class="text-sm font-bold text-red-400 font-display" th:text="${cat.weakWordCount}">0
                                </p>
                            </div>
                            <div class="w-px h-8 bg-text-sub/10 self-center"></div>
                            <div class="flex-1 text-center">
                                <p class="text-[9px] font-bold text-text-sub uppercase mb-1">総解答数</p>
                                <p class="text-sm font-bold text-text-main font-display" th:text="${cat.totalAnswered}">
                                    0</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Pass variables to fragment -->
        <script th:inline="javascript">
            const activePage = 'stats';
            const showNav = true;
        </script>
    </div>
</body>

</html>