# 実行計画: UIおよびロジックの改善 (UI_Logic_Fixes_Plan.md)

本計画では、ユーザーから指摘のあったUIの不具合修正、表示の改善、およびカテゴリ名変更に伴う統計データの整合性確保を実施します。

## 1. 概要
- **単語帳一覧**: 検索窓の削除と、長い意味の全文表示。
- **学習統計**: ツールチップのデザイン調整（色・位置切れ）。
- **ロジック**: カテゴリ名変更後も統計が正しく表示されるよう、集計処理を改善。
- **クイズ結果**: 文言変更、表示切れの修正、レイアウトの微調整。

## 2. 変更内容

### 2.1 単語帳一覧 (`word_list.html`)
- 検索窓（Search/Filterセクション）のHTMLブロックを削除します。
- 単語の意味表示（`word.definition`）および例文表示（`word.exampleSentence`）に使用されている `truncate` クラスを除去し、複数行で全文が表示されるようにCSSクラス（`whitespace-normal`, `line-clamp-none`等）を適用します。

### 2.2 学習統計 (`stats.html`)
- 苦手単語ホバー時のツールチップの背景色を、現在の `bg-gray-800/95` からアプリのテーマに合わせたブラウン系（例: `#4e342e`）に変更します。
- ツールチップが画面端で切れないよう、配置計算（`left: 50%` による中央寄せだけでなく、端付近でのマージン確保など）を調整します。

### 2.3 統計ロジックの改善 (`QuizHistoryRepository.java`, `WordRepository.java`, `StatsService.java`)
- 現在 `GROUP BY c.name` で集計している箇所を、`GROUP BY c.id, c.name` に変更します。これにより、カテゴリ名が変更されても同一のカテゴリIDであれば統計が一貫して表示されるようになります。
- `StatsService` でのマップのキーをカテゴリ名ではなくIDに変更することも検討しましたが、既存の「未分類」対応との兼ね合いを考慮し、まずはSQL側での確実なグルーピングを確認します。

### 2.4 クイズ結果画面 (`quiz_summary.html`)
- タイトルの「学習サマリー」を「クイズ結果」に変更し、スクロール時に追従しないように非固定化。
- 正答一覧の単語・意味の表示において `truncate` と `max-w` による制限を緩和し、意味表示を左寄せに調整します。
- AI応援メッセージの冒頭の空行を除去し、枠（`neu-inset`）とボタン（再挑戦・ホーム）の下部が切れている問題を修正します。

## 3. 実施手順

1. **ブランチ作成**: `issues/ui-logic-fixes` ブランチを作成。
2. **バックエンド修正**: `QuizHistoryRepository` および `WordRepository` のクエリ修正。
3. **フロントエンド修正**:
    - `word_list.html` の検索窓削除とテキスト表示。
    - `stats.html` のツールチップスタイル調整。
    - `quiz_summary.html` の文言・レイアウト修正。
4. **動作確認**: 各画面で表示崩れが解消されていること、統計が正しく表示されることを確認。

## 4. 影響範囲
- 単語帳一覧、統計画面、クイズ結果画面の表示に影響します。
- 既存のDBスキーマへの変更はありません。
