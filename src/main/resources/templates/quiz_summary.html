<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/layout :: head('クイズ結果まとめ')}"></head>

<body th:replace="~{fragments/layout :: layout(~{::mainContent})}">
    <div th:fragment="mainContent"
        class="relative flex h-full min-h-screen w-full max-w-md flex-col overflow-hidden bg-bg-base mx-auto shadow-2xl">
        <!-- Header -->
        <header
            class="sticky top-0 z-20 flex items-center justify-between px-6 py-6 pt-14 bg-bg-base/90 backdrop-blur-sm">
            <h1 class="text-xl font-bold tracking-tight text-text-main font-japanese">クイズ結果</h1>
            <a th:href="@{/}" class="neu-icon-btn h-10 w-10 text-text-sub">
                <span class="material-symbols-outlined text-[20px]">home</span>
            </a>
        </header>

        <main class="flex-1 overflow-y-auto px-6 pb-40 hide-scrollbar pt-4">
            <!-- Score Card (Chart replacement) -->
            <div class="mb-10 flex flex-col items-center">
                <div class="relative w-48 h-48 rounded-full neu-raised flex items-center justify-center mb-6">
                    <div class="absolute inset-4 rounded-full neu-pressed flex flex-col items-center justify-center">
                        <span class="text-4xl font-black text-primary font-display"
                            th:text="${(quizSession.correctAnswers * 100) / quizSession.results.size()} + '%'">0%</span>
                        <span
                            class="text-[10px] font-bold text-text-sub mt-1 tracking-widest font-japanese">SCORES</span>
                    </div>
                </div>
                <div class="flex gap-4">
                    <div class="neu-raised px-6 py-3 rounded-2xl text-center min-w-[100px]">
                        <p class="text-[10px] font-bold text-text-sub uppercase mb-1">正解率</p>
                        <p class="text-lg font-bold text-text-main font-display">
                            <span th:text="${quizSession.correctAnswers}">0</span>
                            <span class="text-xs text-text-sub font-normal mx-0.5">/</span>
                            <span th:text="${quizSession.results.size()}">0</span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- AI Feedback Section -->
            <section class="mb-10">
                <div class="flex items-center gap-2 mb-4">
                    <span class="material-symbols-outlined text-primary text-[20px]">psychology</span>
                    <h2 class="text-sm font-bold text-text-main font-japanese">AI学習アドバイス</h2>
                </div>
                <div class="neu-raised rounded-3xl p-6 relative overflow-hidden group">
                    <div
                        class="absolute -right-2 -top-2 opacity-5 scale-150 rotate-12 group-hover:scale-[1.6] transition-transform duration-700">
                        <span class="material-symbols-outlined text-[100px]">auto_awesome</span>
                    </div>
                    <p class="text-[13px] text-text-main leading-relaxed font-japanese whitespace-pre-wrap relative z-10"
                        th:text="${aiFeedback != null and !#strings.isEmpty(aiFeedback) ? aiFeedback : 'アドバイスを生成できませんでした。'}">
                        AIフィードバック読み込み中...
                    </p>
                </div>
            </section>

            <!-- Inspirational Quote -->
            <section class="mb-10">
                <div class="neu-pressed rounded-3xl p-6 flex flex-col gap-4">
                    <span class="material-symbols-outlined text-primary opacity-30">format_quote</span>
                    <p class="text-sm italic font-medium text-text-sub text-center leading-relaxed" th:text="${quote}">
                        Learning is the only thing the mind never exhausts...
                    </p>
                    <div class="h-px w-8 bg-primary/20 self-center"></div>
                </div>
            </section>

            <!-- Answer List -->
            <section class="mb-10">
                <h2 class="mb-5 text-sm font-bold text-text-main font-japanese flex items-center gap-2">
                    <span class="material-symbols-outlined text-[18px]">list_alt</span>
                    解答の詳細
                </h2>
                <div class="space-y-4">
                    <div th:each="result : ${quizSession.results}"
                        class="neu-raised rounded-2xl p-5 flex flex-col gap-3 group border border-transparent transition-all">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <h3 class="font-bold text-lg text-text-main font-display" th:text="${result.term}">
                                        Apple</h3>
                                    <span th:if="${result.correct}"
                                        class="px-2 py-0.5 rounded-full bg-green-100 text-green-600 text-[9px] font-bold uppercase tracking-tight">Correct</span>
                                    <span th:unless="${result.correct}"
                                        class="px-2 py-0.5 rounded-full bg-red-100 text-red-500 text-[9px] font-bold uppercase tracking-tight">Missed</span>
                                </div>
                                <p class="text-xs text-text-sub font-medium" th:text="${result.meaning}">りんご</p>
                            </div>
                            <div th:classappend="${result.correct == true ? 'text-green-500' : 'text-red-400'}"
                                class="mt-1">
                                <span class="material-symbols-outlined text-[24px]"
                                    th:text="${result.correct ? 'check_circle' : 'cancel'}">check_circle</span>
                            </div>
                        </div>
                        <div class="neu-pressed rounded-xl px-4 py-2.5 flex items-center justify-between">
                            <span class="text-[10px] font-bold text-text-sub uppercase tracking-widest">あなたの回答</span>
                            <span class="text-xs font-bold"
                                th:classappend="${result.correct ? 'text-text-main' : 'text-red-400'}"
                                th:text="${#strings.isEmpty(result.userAnswer) ? '（無回答）' : result.userAnswer}">あっぷる</span>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Bottom Actions -->
        <div class="fixed bottom-0 left-0 right-0 w-full pointer-events-none z-30 max-w-md mx-auto">
            <div class="absolute inset-0 bg-gradient-to-t from-bg-base via-bg-base/90 to-transparent h-full"></div>
            <div class="relative px-8 pb-12 pt-12 pointer-events-auto flex gap-4">
                <a th:href="@{/quiz/settings}"
                    class="flex-1 h-14 rounded-2xl neu-raised flex items-center justify-center gap-2 text-text-main font-bold hover:bg-white/40 active:neu-pressed transition-all">
                    <span class="material-symbols-outlined text-[20px]">refresh</span>
                    <span class="text-sm font-japanese">再挑戦</span>
                </a>
                <a th:href="@{/}"
                    class="flex-[1.5] h-14 rounded-2xl neu-action-btn flex items-center justify-center gap-2">
                    <span class="material-symbols-outlined text-[20px]">home</span>
                    <span class="text-sm font-japanese">ホームへ戻る</span>
                </a>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        const activePage = 'quiz';
        const showNav = false;
    </script>
</body>

</html>