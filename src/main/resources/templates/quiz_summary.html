<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/head :: head('クイズ結果サマリー - VocabularySpring')}"></head>

<body class="font-japanese text-text-main antialiased selection:bg-primary/20 flex flex-col items-center">
    <style>
        body {
            background-color: #f5f4f0;
            color: #4e342e;
            min-height: max(884px, 100dvh);
        }

        .neu-card {
            background-color: #f5f4f0;
            border-radius: 1.5rem;
            box-shadow: 8px 8px 16px #dcdbd8, -8px -8px 16px #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.6);
        }

        .neu-inset {
            background-color: #f0efeb;
            border-radius: 1.5rem;
            box-shadow: inset 5px 5px 10px #dcdbd8, inset -5px -5px 10px #ffffff;
        }

        .neu-btn-round {
            background-color: #f5f4f0;
            border-radius: 9999px;
            box-shadow: 5px 5px 10px #dcdbd8, -5px -5px 10px #ffffff;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .neu-btn-round:active {
            box-shadow: inset 3px 3px 6px #dcdbd8, inset -3px -3px 6px #ffffff;
            transform: scale(0.95);
        }

        .neu-badge-ring {
            background: linear-gradient(145deg, #ffffff, #e6e5e1);
            box-shadow: 7px 7px 14px #d1d0cd, -7px -7px 14px #ffffff;
            border-radius: 9999px;
        }
    </style>
    <div class="relative mx-auto flex h-full min-h-screen w-full max-w-md flex-col overflow-hidden pb-32">

        <header
            class="sticky top-0 z-20 flex items-center justify-between px-6 py-5 bg-background-base/90 backdrop-blur-md">
            <a href="/" class="neu-btn-round size-10 text-text-main/70">
                <span class="material-symbols-outlined text-xl">close</span>
            </a>
            <h1 class="text-lg font-bold tracking-tight text-text-main/90">学習サマリー</h1>
            <div class="size-10"></div>
        </header>

        <main class="flex flex-col items-center px-6 pt-2 pb-8 gap-8">

            <!-- Header / Medal -->
            <div class="flex flex-col items-center text-center w-full mt-4">
                <div class="relative mb-6">
                    <div class="neu-badge-ring p-6 size-28 flex items-center justify-center relative z-10"
                        th:with="rate=${quizSession.results.size() > 0 ? (quizSession.correctAnswers * 100.0) / quizSession.results.size() : 0}">
                        <span class="material-symbols-outlined text-5xl text-[#a1887f]"
                            style="font-variation-settings: 'FILL' 1;"
                            th:text="${rate == 100 ? 'emoji_events' : (rate >= 80 ? 'military_tech' : (rate >= 50 ? 'thumb_up' : 'local_fire_department'))}">military_tech</span>
                    </div>
                    <div
                        class="absolute -top-1 -right-1 size-9 rounded-full bg-[#a1887f] text-white flex items-center justify-center shadow-md z-20 border-2 border-[#f5f4f0]">
                        <span class="material-symbols-outlined text-sm">star</span>
                    </div>
                </div>
                <h2 class="text-2xl font-bold text-text-main mb-3 tracking-wide">お疲れ様でした！</h2>
                <div class="flex flex-col items-center max-w-[90%] gap-1">
                    <p class="text-sm font-medium italic text-text-sub/90 font-display leading-relaxed text-center"
                        th:utext="${quote != null ? #strings.replace(quote, ' - ', '<br>- ') : ''}">
                        "天才とは、1％のひらめきと99％の努力である"
                    </p>
                </div>
            </div>

            <!-- Score Card -->
            <div class="neu-card w-full p-6 flex flex-col gap-6">
                <div class="flex items-center justify-between">
                    <div class="flex flex-col">
                        <span class="text-xs font-bold text-text-main/60 mb-0.5">正解数</span>
                        <div class="flex items-baseline gap-1">
                            <span class="text-4xl font-bold text-text-main font-display"
                                th:text="${quizSession.correctAnswers}">8</span>
                            <span class="text-xl font-medium text-text-sub font-display"
                                th:text="'/' + ${quizSession.results.size()}">/10</span>
                        </div>
                    </div>

                    <div class="relative size-16">
                        <div
                            class="absolute inset-0 rounded-full shadow-[inset_2px_2px_5px_#dcdbd8,inset_-2px_-2px_5px_#ffffff] bg-[#f0efeb]">
                        </div>
                        <svg class="relative size-full -rotate-90" viewBox="0 0 36 36">
                            <path class="text-transparent"
                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                fill="none" stroke="currentColor" stroke-width="3"></path>
                            <!-- Dash array is max 100. Calculate dynamically -->
                            <path class="text-[#a1887f] drop-shadow-sm"
                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                fill="none" stroke="currentColor"
                                th:stroke-dasharray="${(quizSession.correctAnswers * 100.0) / quizSession.results.size()} + ', 100'"
                                stroke-linecap="round" stroke-width="3"></path>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-xs font-bold text-text-main/70"
                                th:text="${#numbers.formatDecimal((quizSession.correctAnswers * 100.0) / quizSession.results.size(), 0, 0)} + '%'">80%</span>
                        </div>
                    </div>
                </div>

                <div class="h-2 w-full rounded-full bg-gray-200 shadow-inner overflow-hidden">
                    <div class="h-full rounded-full bg-[#a1887f] transition-all duration-1000 ease-out"
                        th:style="'width: ' + ${(quizSession.correctAnswers * 100.0) / quizSession.results.size()} + '%'">
                    </div>
                </div>

                <hr class="border-t border-black/5 mx-2" />

                <div class="flex flex-col gap-3">
                    <!-- Result List -->
                    <div th:each="result : ${quizSession.results}" class="flex items-center justify-between py-1 px-1">
                        <div class="flex items-center gap-3">
                            <span th:if="${result.correct}"
                                class="material-symbols-outlined text-success text-lg bg-success/10 rounded-full p-0.5">check_circle</span>
                            <span th:unless="${result.correct}"
                                class="material-symbols-outlined text-error text-lg bg-error/10 rounded-full p-0.5">cancel</span>
                            <span class="text-[13px] font-bold text-text-main font-display truncate max-w-[140px]"
                                th:text="${result.term}">Architecture</span>
                        </div>
                        <span class="text-xs font-bold text-text-sub/70 truncate max-w-[100px]"
                            th:text="${result.meaning}">建築</span>
                    </div>
                </div>
            </div>

            <!-- AI Feedback -->
            <div class="w-full flex flex-col gap-3">
                <div class="flex items-center gap-2 pl-1">
                    <div class="size-8 rounded-full bg-[#d7ccc8] flex items-center justify-center shadow-sm text-white">
                        <span class="material-symbols-outlined text-lg">smart_toy</span>
                    </div>
                    <h3 class="font-bold text-text-main text-sm">AIからの応援メッセージ</h3>
                </div>
                <div class="neu-inset p-5 relative">
                    <p th:if="${aiFeedback != null and !#strings.isEmpty(aiFeedback)}"
                        class="text-sm text-text-main leading-relaxed tracking-wide whitespace-pre-wrap"
                        th:text="${aiFeedback}">
                        素晴らしいですね！...
                    </p>
                    <p th:unless="${aiFeedback != null and !#strings.isEmpty(aiFeedback)}"
                        class="text-xs text-text-sub/80 italic">
                        AIからのコメントを取得できませんでした。
                    </p>
                </div>
            </div>

        </main>

        <!-- Bottom Actions -->
        <div
            class="fixed bottom-24 left-0 right-0 max-w-md mx-auto z-30 flex items-center justify-center p-6 pb-2 bg-gradient-to-t from-[#f5f4f0] via-[#f5f4f0] to-transparent pt-12">
            <div class="flex w-full gap-4">
                <a href="/quiz/settings"
                    class="neu-btn-round flex-1 py-4 text-sm font-bold text-text-main/70 hover:text-text-main active:scale-[0.98]">
                    <span class="material-symbols-outlined text-lg mr-2">refresh</span>
                    再挑戦
                </a>
                <a href="/"
                    class="flex-1 rounded-full bg-[#a1887f] py-4 text-sm font-bold text-white shadow-[4px_4px_10px_rgba(161,136,127,0.4),-4px_-4px_10px_rgba(255,255,255,0.8)] active:shadow-inner active:-translate-y-0.5 transition-all flex items-center justify-center gap-2 hover:bg-[#8d6e63]">
                    <span class="material-symbols-outlined text-lg">home</span>
                    ホーム
                </a>
            </div>
        </div>
        <div th:replace="~{fragments/bottom_nav :: bottomNav('quiz')}"></div>
    </div>
</body>

</html>