<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/head :: head('VocabularySpring - 学習統計状況')}"></head>

<body
    class="bg-background-light text-text-main font-body min-h-screen flex flex-col items-center justify-start antialiased selection:bg-primary/20">
    <style>
        .neu-text-shadow {
            text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.6);
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        body {
            min-height: max(884px, 100dvh);
        }

        .chart-wrapper {
            width: 100%;
            height: 200px;
            padding: 10px 0;
        }
    </style>
    <div class="relative w-full max-w-md h-full min-h-[100dvh] flex flex-col bg-background-light shadow-2xl pb-40">

        <header
            class="pt-12 pb-2 px-6 flex justify-between items-center sticky top-0 z-20 bg-background-light/95 backdrop-blur-sm shadow-[0_4px_10px_rgba(0,0,0,0.02)]">
            <div>
                <h1 class="text-[22px] font-bold text-text-main neu-text-shadow tracking-tight">学習統計</h1>
                <p class="text-[11px] text-text-sub font-medium mt-1 ml-1"
                    th:text="'総解答数 ' + ${totalStats.totalAnswered} + ' 回'">カテゴリ別分析データ</p>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto px-6 mt-6 pb-12 w-full space-y-10" th:if="${totalStats.totalAnswered > 0}">

            <!-- 全体サマリー概要 -->
            <div class="grid grid-cols-2 gap-4">
                <div
                    class="rounded-3xl bg-background-light shadow-neu p-4 flex flex-col items-center justify-center text-center">
                    <span class="material-symbols-outlined text-primary mb-1">target</span>
                    <span class="text-2xl font-bold font-display"
                        th:text="${#numbers.formatDecimal(totalStats.correctRate, 0, 1)} + '%'">80%</span>
                    <span class="text-[10px] text-text-sub font-medium">全体正答率</span>
                </div>

                <div
                    class="rounded-3xl bg-background-light shadow-neu p-4 flex flex-col items-center justify-center text-center">
                    <span class="material-symbols-outlined text-rose-500/80 mb-1">warning</span>
                    <span class="text-2xl font-bold font-display text-rose-500/80"
                        th:text="${totalStats.weakWordCount}">0</span>
                    <span class="text-[10px] text-text-sub font-medium">全体苦手単語</span>
                </div>
            </div>

            <div class="w-full h-px bg-[#c2beb9]/20 my-4"></div>

            <!-- カテゴリごとの統計ループ -->
            <section class="space-y-6" th:each="cat, iterStat : ${categoryDetailStats}">

                <div class="flex items-center gap-3 px-1">
                    <div
                        class="size-10 rounded-xl bg-background-light shadow-neu flex items-center justify-center text-primary-dark">
                        <span class="material-symbols-outlined text-[20px]">category</span>
                    </div>
                    <h2 class="text-lg font-bold text-text-main" th:text="${cat.categoryName}">カテゴリ名</h2>
                </div>

                <div class="rounded-3xl bg-background-light shadow-neu p-5 relative overflow-hidden">
                    <div class="flex flex-col gap-6">
                        <!-- Circle and Grid -->
                        <div class="flex items-center gap-6">
                            <div
                                class="shrink-0 relative size-28 rounded-full shadow-neu-pressed flex items-center justify-center bg-background-light mx-2">
                                <svg class="size-full -rotate-90 p-1.5" viewBox="0 0 36 36">
                                    <path class="text-transparent"
                                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                        fill="none" stroke="currentColor" stroke-width="3"></path>
                                    <path class="text-[#8d6e63] drop-shadow-sm transition-all duration-1000 ease-out"
                                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                        fill="none" stroke="currentColor"
                                        th:stroke-dasharray="${cat.correctRate} + ', 100'" stroke-linecap="round"
                                        stroke-width="3"></path>
                                </svg>
                                <div class="absolute flex flex-col items-center">
                                    <span class="text-[10px] text-text-sub font-bold -mb-1">正答率</span>
                                    <span class="text-2xl font-display font-bold text-text-main"
                                        th:text="${#numbers.formatDecimal(cat.correctRate, 0, 0)} + '%'">85%</span>
                                </div>
                            </div>

                            <div class="flex-1 grid grid-cols-2 gap-3">
                                <div
                                    class="flex flex-col justify-center py-6 px-1 rounded-2xl bg-background-light shadow-neu-sm text-center">
                                    <span class="text-[9px] text-text-sub font-medium mb-1 line-clamp-1">累計解答数</span>
                                    <span class="text-base font-bold text-text-main"
                                        th:text="${cat.totalAnswered}">142</span>
                                </div>
                                <div
                                    class="flex flex-col justify-center py-6 px-1 rounded-2xl bg-background-light shadow-neu-sm text-center">
                                    <span class="text-[9px] text-text-sub font-medium mb-1 line-clamp-1">登録単語数</span>
                                    <span class="text-base font-bold text-text-main"
                                        th:text="${cat.wordCount}">35</span>
                                </div>
                            </div>
                        </div>

                        <!-- Weak Words List -->
                        <div class="w-full pt-4 border-t border-[#c2beb9]/20"
                            th:if="${cat.weakWords != null and !cat.weakWords.isEmpty()}">
                            <div class="flex items-center gap-2 mb-3 px-2">
                                <span class="text-xs text-text-main font-bold">苦手単語</span>
                                <span
                                    class="text-[10px] text-text-sub font-bold bg-background-light shadow-[inset_2px_2px_5px_rgba(0,0,0,0.05),inset_-2px_-2px_5px_rgba(255,255,255,0.8)] px-2 py-0.5 rounded-full"
                                    th:text="${#lists.size(cat.weakWords)} + ' Words'">3 Words</span>
                            </div>
                            <div class="flex flex-wrap gap-2 px-1 pb-1">
                                <span
                                    class="group relative px-3 py-1.5 rounded-lg bg-red-50 text-error font-medium text-xs border border-red-100/50 shadow-sm cursor-help"
                                    th:each="ww : ${cat.weakWords}">
                                    <span th:text="${ww.term}">word</span>
                                    <!-- Tooltip -->
                                    <div
                                        class="pointer-events-none absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-max max-w-[180px] rounded-xl bg-[#4e342e]/95 p-3 text-[#f5f4f0] opacity-0 transition-opacity group-hover:opacity-100 z-50 text-left shadow-lg">
                                        <p class="font-bold text-xs mb-1 leading-tight whitespace-normal"
                                            th:text="${ww.definition}">意味
                                        </p>
                                        <p class="text-[9px] text-[#f5f4f0]/80 italic leading-snug whitespace-normal"
                                            th:if="${ww.exampleSentence != null and !ww.exampleSentence.isEmpty()}"
                                            th:text="${ww.exampleSentence}">例文</p>
                                        <div
                                            class="absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-[#4e342e]/95">
                                        </div>
                                    </div>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="w-full h-px bg-[#c2beb9]/20 my-6"></div>
            </section>

        </main>

        <!-- Empty State -->
        <main class="flex-1 overflow-y-auto px-6 mt-6 pb-12 w-full flex flex-col items-center justify-center pt-24"
            th:if="${totalStats.totalAnswered == 0}">
            <div
                class="size-20 rounded-full bg-background-light shadow-neu-pressed flex items-center justify-center text-text-sub/50 mb-6">
                <span class="material-symbols-outlined text-4xl">psychology</span>
            </div>
            <p class="text-sm font-bold text-text-main mb-2">データがありません</p>
            <p class="text-xs text-text-sub mb-8">クイズに挑戦して、学習を記録しましょう。</p>
            <a href="/quiz/settings"
                class="px-8 py-3 rounded-full bg-primary text-white font-bold shadow-neu-btn active:scale-95 transition-all text-sm">クイズに挑戦する</a>
        </main>

        <div th:replace="~{fragments/bottom_nav :: bottomNav('stats')}"></div>
    </div>

    <!-- Chart script removed as requested -->
</body>

</html>