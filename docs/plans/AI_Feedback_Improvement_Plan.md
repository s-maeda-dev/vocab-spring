# 実行計画: AIフィードバックの改善 (AI_Feedback_Improvement_Plan.md)

本計画では、クイズ終了後に表示されるAI応援メッセージの質を向上させ、学習カテゴリに応じた専門的なアドバイスと、間違えた単語の具体的な補足を含むように改善します。

## 1. 概要
- **AIの役割の明確化**: カテゴリ名の学習を支援する専門家として振る舞う。
- **コンテキストの強化**: クイズのカテゴリ名、間違えた単語の「単語」と「意味」の両方をAIに提供する。
- **フィードバックの質向上**: 間違えた問題に対する具体的な補足説明と励ましを生成する。

## 2. 変更内容

### 2.1 データモデル / サービスのインターフェース変更
- `GeminiService.getFeedback` メソッドの引数を拡張し、カテゴリ名と間違えた単語の詳細情報（単語名と意味のペア）を受け取れるようにします。
- `QuizController.showSummary` で、現在のセッション情報からカテゴリ名を取得し、間違えた単語のリスト（`term` と `meaning`）を組み立てて `GeminiService` に渡します。

### 2.2 プロンプトの改善 (`GeminiService.java`)
- AIへの命令（システムプロンプト）を以下のように調整します：
    - 「あなたは『[カテゴリ名]』の学習を支援する専門家です」と役割を定義。
    - 間違えた単語とその意味を提示し、それに基づいた補足説明（覚え方のコツ、間違えやすいポイントなど）を求める。
    - 学習者を励ますトーンを維持し、日本語で150〜200文字程度のコメントを生成させる。

### 2.3 `QuizController.java` の修正
- `categoryId` が null の場合は「全般的な学習」として扱う。
- `categoryId` がある場合は `CategoryRepository` 等を通じてカテゴリ名を取得する。

## 3. 実施手順

1. **ブランチ作成**: `issues/ai-feedback-improvement` (実施済み)
2. **バックエンド修正**:
    - `GeminiService.java` の `getFeedback` メソッドシグネチャとプロンプトの修正。
    - `QuizController.java` の `showSummary` における引数構築ロジックの修正。
3. **動作確認**: クイズを実行し、終了後のメッセージがカテゴリに基づいた内容になっているか確認。

## 4. 影響範囲
- クイズ結果サマリー画面のAIメッセージ生成ロジックに限定されます。
