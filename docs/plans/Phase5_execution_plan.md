# Phase 5 実行計画書: 学習記録・AI連携（コア価値）の実装

本書は、MVP要件定義書の「Phase5: 学習記録・AI連携」を詳細化した作業手順書です。本アプリケーションのコア価値となる、クイズ結果の蓄積とGemini APIを活用したフィードバック機能を開発します。

## 1. 学習履歴（クイズ結果）の保存機能

### 1-1. エンティティとリポジトリの作成
- [x] `QuizHistory` エンティティの作成
  - 必要なフィールド: ユーザーID (User)、単語ID (Word)、正誤 (`boolean isCorrect`)、解答日時 (`LocalDateTime answeredAt`)
- [x] `QuizHistoryRepository` インターフェースの作成
  - ユーザーIDでの検索、ユーザーごとの過去の不正解単語（苦手単語）の取得メソッド定義

### 1-2. 学習履歴保存ロジックの実装
- [x] `QuizService` にクイズ解答時に履歴を保存するメソッドを追加
  - 一問一答の解答時にDBへ保存する処理
  - ユーザーID、単語ID、正解/不正解、現在のタイムスタンプを保存する

## 2. クイズ結果まとめ画面の実装

### 2-1. QuizController の設定 (結果表示)
- [x] `GET /quiz/summary`：クイズセット完了時の画面表示用メソッド追加
  - セッションに保存された解答履歴（正解数、全問題数、各問題の正解/不正解リスト）をモデルに渡す

### 2-2. クイズ結果まとめ画面 (quiz_summary.html) の作成
- [x] `src/main/resources/templates/quiz_summary.html` の作成
- [x] 今回の正解数・正答率の表示
- [x] 出題された全単語と解答、正誤判定の一覧表示（復習用）
- [x] 例文がある場合の例文表示

## 3. 偉人の名言表示ロジックの実装

### 3-1. 名言データの準備・取得機能
- [x] 名言のリストをハードコードし、ランダムで取得する処理の実装
- [x] コントローラーでランダムに1つの名言を取得し、結果画面 (`quiz_summary.html`) へ渡すように実装

## 4. Gemini API連携（フィードバック生成）

### 4-1. Gemini APIクライアントの実装
- [x] `application.properties` に Gemini API URL を設定（モデル: gemini-2.5-flash）
- [x] `.env` ファイルに Gemini API キーを設定（セキュリティ対策: .gitignore で除外済み）
- [x] `.env.example` を作成（チーム共有用の雛形ファイル）
- [x] `GeminiService` の作成
  - RestTemplate を用いて Gemini API へリクエストを送信する処理の実装

### 4-2. プロンプト構築ロジックの実装
- [x] `GeminiService` にてプロンプト構築処理を作成
  - 今回の正答率（例：10問中8問正解）を組み込む
  - DB (`QuizHistory`) から直近で間違えた単語のリスト（過去の苦手単語）を取得しプロンプトに組み込む
  - 「ユーザーを励ますトーンで、苦手単語についてのアドバイスを含める」といったシステムプロンプトの調整

### 4-3. 結果画面へのAIフィードバック統合
- [x] クイズ完了時に同期でGemini APIからコメントを取得し、画面に表示する

## 5. 動作確認・テスト

### 5-1. 学習履歴の確認
- [x] クイズを解答した後に、データベースの履歴テーブルに正しい内容でレコードが作成されているか確認
- [ ] 苦手単語（不正解となった単語）の抽出が正しく行えるか確認

### 5-2. API連携および結果画面の確認
- [x] クイズ完了時に、出題一覧と正解数が正しく表示されることを確認
- [x] 偉人の名言がランダムに表示されることを確認
- [x] Gemini APIから、今回の結果と苦手単語を踏まえた励ましのコメントが生成・表示されることを確認
